# Материалы для КММО-1-20

Материалы содержат только информацию, касающуюся OpenBSD и Linux.
При желании студент может осуществлять разработку под любую ОС, но в этом случае
придётся осуществлять заметно больше самостоятельных действий по подготовке.

## OpenBSD

Код курсовой работы должен быть реализован как файловая система **cwfs**.
После выполнения инструкций выше «рыба» уже подготовлена в подкаталоге `cwfs`
каталога с исходными текстами ядра (`/usr/src/sys` по умолчанию).

Для подгтовки рабочей среды и первоначальной сборки необходимой инфраструктуры
достаточно ввести команду:

	make

После этого в каталоге `/usr/src` будут распакованы исходные тексты базовой
системы OpenBSD, а в `/usr/src/sys` — исходные тексты ядра. Также будут применены
необходимые патчи, интегрирующие cwfs в систему, и будет произведена первоначальная
сборка ядра и затронутых компонентов базовой системы; в дальнейшем запуск `make`
будет происходить намного быстрее, так как будут пересобираться лишь изменённые
исходные модули.

Для установки собранных компонентов требуются права суперпользователя:

	doas make install

При желании можно настроить используемые каталоги и другие параметры сборки,
см. первые строчки `Makefile`.

Все цели, кроме `base`, `kernel` и `kernel-config`, имеют версии с суффиксами
для работы только в отношении ядра или базовой ОС, например:
`fetch-kernel`, `install-base` и так далее.

Цели, используемые для выполнения сборки и установки собранных компонентов:

* `make fetch` — скачивает немодифицированные исходные тексты OpenBSD 6.8.
* `make unpack` — распаковывает исходные тексты в `BASE_SRC_DIR` и `KERNEL_SRC_DIR`.
* `make base` — то же, что `make patch-base build-base`.
* `make kernel` — то же, что `make patch-kernel build-kernel`.
* `make all` (по умолчанию) — то же, что и `make base kernel`.
* `make install` — устанавливает ядро и модифицированные узлы базовой ОС.

### Дополнительные цели, полезные в работе:

* `make build` — собирает базовую систему и ядро, безотносительно наложения патчей.
* `make clean` — удаляет промежуточные и конечные результаты сборки.
* `make distclean` — удаляет всё, кроме скачанных архивов с исходными текстами.
* `make kernel-config` — переконфигурирует ядро.
* `make patch` — применяет патчи, содержащие «рыбу» для выполнения курсовой работы.
* `make unpatch` — убирает патчи, содержащие «рыбу» для выполнения курсовой работы.

При необходимости цели вызывают друг друга. Например, если `sys.tar.gz` ещё не был
скачан, то `unpack-kernel` вызовет сначала `fetch-kernel`.

## Linux

Подробное описание процесса создания файловой системы уровня ядра в Linux,
на английском языке:
https://linux-kernel-labs.github.io/refs/heads/master/labs/filesystems_part1.html

Потребуются исходные тексты ядра; желательно использовать поставляемый
с вашим дистрибутивом Linux пакет исходных текстов, обычно это что-то вроде
`linux-sources` или `kernel-source`. Инструкции по сборке ядра в различных
дистрибутивах Linux приведены ниже:

* [https://wiki.gentoo.org/wiki/Kernel/Configuration/ru](ALT)
* [https://wiki.archlinux.org/title/Kernel_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)/Arch_Build_System_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)](Arch)
* [https://wiki.centos.org/HowTos/Custom_Kernel](CentOS) (на английском)
* [https://wiki.debian.org/BuildADebianKernelPackage](Debian) (на английском)
* [https://wiki.gentoo.org/wiki/Kernel/Configuration/ru](Gentoo)
* [https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel](Ubuntu) (на английском)
